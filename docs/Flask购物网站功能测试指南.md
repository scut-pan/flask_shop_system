# Flask购物网站功能测试指南

## 测试概述

本文档提供详细的测试步骤，用于验证Flask购物网站的各项功能是否正常工作。

---

## 第1部分：测试前准备

### 1.1 环境检查

**测试目标**: 确保开发环境已正确配置

**测试步骤**:
```bash
# 1. 检查Python版本（需要3.10+）
python --version

# 2. 检查uv是否安装
uv --version

# 3. 检查依赖是否安装
uv tree

# 4. 检查MySQL服务是否运行
# Windows:
net start mysql80
# macOS/Linux:
# sudo systemctl status mysql

# 5. 检查.env配置文件是否存在
cat .env
```

**预期结果**:
- Python版本 >= 3.10
- uv已安装
- 所有依赖已安装
- MySQL服务正在运行
- .env文件存在且配置正确

**注意事项**:
- 如果MySQL未启动，需要先启动MySQL服务
- 确保.env文件中的数据库配置正确

---

### 1.2 数据库初始化

**测试目标**: 确保数据库表结构正确创建，管理员账号已创建

**测试步骤**:
```bash
# 1. 删除旧数据库（如果需要重新开始）
mysql -u root -p
> DROP DATABASE IF EXISTS shop_db;
> CREATE DATABASE shop_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
> EXIT;

# 2. 运行数据库初始化脚本
uv run python init_db.py
```

**预期结果**:
```
✓ 管理员用户创建成功
  用户名: admin
  密码: admin123
  邮箱: admin@shop.com

数据库初始化完成！
```

**验证步骤**:
```bash
# 登录MySQL验证表已创建
mysql -u shop_user -p
> USE shop_db;
> SHOW TABLES;
> SELECT * FROM users;
> EXIT;
```

**注意事项**:
- 如果重新初始化数据库，所有之前的数据将被清空
- 记住管理员账号：admin / admin123

---

### 1.3 启动应用

**测试目标**: 确保应用能正常启动

**测试步骤**:
```bash
# 启动Flask应用
uv run python main.py
```

**预期结果**:
```
 * Serving Flask app 'main'
 * Debug mode: on
 * Running on http://127.0.0.1:5000
```

**验证步骤**:
1. 打开浏览器访问: http://127.0.0.1:5000
2. 应该能看到首页

**注意事项**:
- 保持终端窗口打开，不要关闭
- 如果看到错误信息，根据错误提示解决问题

---

## 第2部分：用户认证功能测试

### 2.1 用户注册功能

**测试目标**: 验证新用户注册功能

**测试步骤**:

1. 访问注册页面
   - URL: http://127.0.0.1:5000/auth/register
   - 或从首页点击"注册"链接

2. 填写注册表单
   ```
   用户名: testuser
   邮箱: testuser@example.com
   密码: Test123456
   确认密码: Test123456
   ```

3. 点击"注册"按钮

**预期结果**:
- 显示成功提示: "注册成功！请登录"
- 自动跳转到登录页面
- 数据库users表中新增一条记录

**验证数据库**:
```sql
SELECT id, username, email, is_admin, created_at FROM users WHERE username='testuser';
```

---

### 2.2 注册表单验证

**测试目标**: 验证注册表单的验证规则

**测试场景 2.2.1: 用户名太短**
```
用户名: abc
邮箱: test2@example.com
密码: Test123456
确认密码: Test123456
```
**预期结果**: 显示错误提示"用户名长度必须在4-20个字符之间"

**测试场景 2.2.2: 密码不一致**
```
用户名: testuser2
邮箱: test2@example.com
密码: Test123456
确认密码: Test1234567
```
**预期结果**: 显示错误提示"两次输入的密码不一致"

**测试场景 2.2.3: 邮箱格式错误**
```
用户名: testuser3
邮箱: invalid-email
密码: Test123456
确认密码: Test123456
```
**预期结果**: 显示错误提示"邮箱格式不正确"

**测试场景 2.2.4: 重复用户名**
```
用户名: testuser（已存在）
邮箱: test3@example.com
密码: Test123456
确认密码: Test123456
```
**预期结果**: 显示错误提示"用户名已存在"

**测试场景 2.2.5: 重复邮箱**
```
用户名: testuser4
邮箱: testuser@example.com（已存在）
密码: Test123456
确认密码: Test123456
```
**预期结果**: 显示错误提示"邮箱已被注册"

---

### 2.3 用户登录功能

**测试目标**: 验证用户登录功能

**测试步骤**:

1. 访问登录页面
   - URL: http://127.0.0.1:5000/auth/login
   - 或从首页点击"登录"链接

2. 使用刚注册的账号登录
   ```
   用户名: testuser
   密码: Test123456
   ```

3. 点击"登录"按钮

**预期结果**:
- 显示成功提示: "欢迎回来，testuser！"
- 跳转到首页
- 导航栏显示用户名和"购物车"、"退出"链接
- 不再显示"登录"、"注册"链接

**验证会话**:
```bash
# 浏览器开发者工具 -> Application -> Cookies
# 查看session cookie是否存在
```

---

### 2.4 登录功能验证

**测试场景 2.4.1: 错误的密码**
```
用户名: testuser
密码: WrongPassword123
```
**预期结果**: 显示错误提示"用户名或密码错误"

**测试场景 2.4.2: 不存在的用户**
```
用户名: nonexistent
密码: Test123456
```
**预期结果**: 显示错误提示"用户名或密码错误"

**测试场景 2.4.3: 空用户名**
```
用户名: （留空）
密码: Test123456
```
**预期结果**: 显示"此字段必填"错误提示

**测试场景 2.4.4: 记住我功能**
1. 勾选"记住我"复选框
2. 登录
3. 关闭浏览器
4. 重新打开浏览器访问网站
**预期结果**: 仍然保持登录状态

---

### 2.5 用户登出功能

**测试目标**: 验证用户登出功能

**测试步骤**:
1. 确保已登录
2. 点击导航栏的"退出"链接
   - URL: http://127.0.0.1:5000/auth/logout

**预期结果**:
- 显示提示: "您已成功退出登录"
- 跳转到首页
- 导航栏显示"登录"、"注册"链接
- 购物车链接消失

**验证**:
- 尝试访问需要登录的页面（如购物车）
- 应该被重定向到登录页面

---

### 2.6 访问控制测试

**测试场景 2.6.1: 未登录访问购物车**
1. 确保已登出
2. 直接访问: http://127.0.0.1:5000/cart

**预期结果**:
- 重定向到登录页面
- 显示提示: "请先登录访问此页面"

**测试场景 2.6.2: 未登录访问订单**
1. 确保已登出
2. 直接访问: http://127.0.0.1:5000/orders

**预期结果**:
- 重定向到登录页面

**测试场景 2.6.3: 已登录用户访问注册页面**
1. 登录账号
2. 访问: http://127.0.0.1:5000/auth/register

**预期结果**:
- 重定向到首页
- 显示提示: "您已经登录"

---

### 2.7 个人资料功能

**测试目标**: 验证个人资料查看和编辑功能

**测试步骤 2.7.1: 查看个人资料**
1. 登录账号
2. 访问个人资料页面（如果实现了该功能）
   - URL: http://127.0.0.1:5000/auth/profile

**预期结果**:
- 显示用户信息：用户名、邮箱
- 显示注册时间

**测试步骤 2.7.2: 修改个人资料**（如果实现）
1. 点击"编辑资料"按钮
2. 修改邮箱或其他可编辑字段
3. 提交表单

**预期结果**:
- 显示成功提示
- 信息已更新

---

### 2.8 修改密码功能

**测试目标**: 验证修改密码功能（如果实现）

**测试步骤**:
1. 登录账号
2. 访问修改密码页面
   - URL: http://127.0.0.1:5000/auth/change-password
3. 填写表单
   ```
   旧密码: Test123456
   新密码: NewPassword789
   确认新密码: NewPassword789
   ```
4. 提交表单

**预期结果**:
- 显示成功提示
- 可以使用新密码登录

**验证**:
1. 退出登录
2. 使用新密码登录
3. 应该能成功登录

---

### 2.9 注销账号功能

**测试目标**: 验证用户注销账号功能(永久删除)

**测试步骤 2.9.1: 普通用户注销账号**

1. 登录普通用户账号(非管理员)
2. 访问个人中心页面
   - URL: http://127.0.0.1:5000/auth/profile
3. 点击"注销账号"按钮
   - URL: http://127.0.0.1:5000/auth/delete_account
4. 在注销页面填写表单
   ```
   当前密码: Test123456
   确认注销: 勾选确认框
   ```
5. 点击"确认注销账号"按钮

**预期结果**:
- 显示成功提示: "您的账号已成功注销,期待再次相见"
- 自动登出并重定向到首页
- 导航栏显示"登录"、"注册"链接
- 该用户无法再登录

**验证数据库**:
```sql
-- 检查用户是否已删除
SELECT * FROM users WHERE username='testuser';
-- 应该返回空结果

-- 检查订单是否已删除(级联删除)
SELECT * FROM orders WHERE user_id=(SELECT id FROM users WHERE username='testuser');
-- 应该返回空结果

-- 检查购物车是否已删除
SELECT * FROM cart_items WHERE user_id=(SELECT id FROM users WHERE username='testuser');
-- 应该返回空结果
```

---

**测试步骤 2.9.2: 管理员尝试注销**

1. 登录管理员账号
   ```
   用户名: admin
   密码: admin123
   ```
2. 访问个人中心
3. 点击"注销账号"按钮

**预期结果**:
- 显示错误提示: "管理员账号不允许自助注销,请联系其他管理员处理"
- 重定向回个人中心页面
- 管理员账号无法通过前台注销

---

**测试步骤 2.9.3: 密码错误无法注销**

1. 登录普通用户
2. 访问注销页面
3. 输入错误的密码
   ```
   当前密码: WrongPassword
   确认注销: 勾选确认框
   ```
4. 点击"确认注销账号"按钮

**预期结果**:
- 显示错误提示: "密码错误,无法注销账号"
- 账号不会被注销
- 仍然保持登录状态

---

**测试步骤 2.9.4: 未勾选确认框无法注销**

1. 登录普通用户
2. 访问注销页面
3. 输入正确密码
4. 不勾选确认框
5. 点击"确认注销账号"按钮

**预期结果**:
- 显示错误提示: "请勾选确认框以继续"
- 账号不会被注销

---

**安全要点**:
- ✅ 需要输入密码确认身份
- ✅ 需要勾选确认框防止误操作
- ✅ 管理员账号不能自助注销
- ✅ 注销后级联删除所有相关数据(订单、购物车)
- ✅ 操作不可撤销,有明确的警告提示

---

## 第3部分：商品功能测试

### 3.1 准备测试数据

**测试目标**: 创建测试用的商品数据

**测试步骤 3.1.1: 使用管理员账号添加商品**

1. 登录管理员账号
   ```
   用户名: admin
   密码: admin123
   ```

2. 访问管理员商品管理页面
   - URL: http://127.0.0.1:5000/admin/products

3. 点击"添加商品"按钮

4. 填写商品表单
   ```
   商品名称: 测试商品1
   商品描述: 这是一个测试商品，用于功能测试
   价格: 99.99
   库存: 50
   商品图片: 上传一张测试图片
   是否上架: 勾选
   ```

5. 点击"保存"按钮

6. 重复以上步骤，创建多个测试商品（建议至少5个）

**测试商品清单建议**:
- 商品1: 手机 - 2999.00元 - 库存20
- 商品2: 笔记本电脑 - 5999.00元 - 库存10
- 商品3: 耳机 - 299.00元 - 库存100
- 商品4: 鼠标 - 99.00元 - 库存200
- 商品5: 键盘 - 199.00元 - 库存150

**预期结果**:
- 每个商品添加成功后显示成功提示
- 商品列表中显示新添加的商品
- 数据库products表中新增记录

---

### 3.2 商品列表展示

**测试目标**: 验证商品列表页功能

**测试步骤**:
1. 访问首页（商品列表）
   - URL: http://127.0.0.1:5000/
   - 或: http://127.0.0.1:5000/products

**预期结果**:
- 显示所有已上架的商品
- 每个商品显示：图片、名称、价格、库存
- 商品以卡片或列表形式展示
- 点击商品可以进入详情页

**验证要点**:
- ✅ 商品信息完整显示
- ✅ 价格格式正确（如：¥99.99）
- ✅ 库存显示正确
- ✅ 图片加载正常
- ✅ 布局美观，响应式设计

---

### 3.3 分页功能

**测试目标**: 验证商品分页功能（如果商品数量超过每页显示数量）

**测试步骤**:
1. 添加超过12个商品（假设每页显示12个）
2. 访问商品列表页
3. 查看底部分页导航

**预期结果**:
- 第1页显示前12个商品
- 显示分页导航：第1页、第2页、下一页等
- 点击"下一页"或页码可以切换

**验证步骤**:
1. 点击第2页
2. 应该显示第13-24个商品
3. 点击"上一页"返回第1页

---

### 3.4 商品详情页

**测试目标**: 验证商品详情页功能

**测试步骤**:
1. 从商品列表点击任意商品
2. 或直接访问: http://127.0.0.1:5000/products/1

**预期结果**:
- 显示商品详细信息
  - 商品图片（大图）
  - 商品名称
  - 商品描述
  - 价格
  - 库存数量
- 显示"加入购物车"按钮
- 显示"继续购物"或"返回列表"链接

**验证要点**:
- ✅ 所有信息准确无误
- ✅ 图片清晰可见
- ✅ 库存为0时，"加入购物车"按钮应禁用或隐藏
- ✅ 页面布局美观

---

### 3.5 商品搜索功能（如果实现）

**测试目标**: 验证商品搜索功能

**测试步骤 3.5.1: 按名称搜索**
1. 在搜索框输入: "手机"
2. 点击搜索按钮

**预期结果**:
- 显示名称包含"手机"的所有商品

**测试步骤 3.5.2: 无结果搜索**
1. 在搜索框输入: "不存在的商品xyz"
2. 点击搜索按钮

**预期结果**:
- 显示"没有找到相关商品"提示
- 或显示空的商品列表

---

### 3.6 库存不足处理

**测试目标**: 验证库存不足时的显示

**测试步骤**:
1. 添加一个库存为0的商品
2. 访问商品详情页

**预期结果**:
- 显示"库存不足"或"暂时缺货"提示
- "加入购物车"按钮禁用或显示"缺货"
- 或按钮完全隐藏

---

## 第4部分：购物车功能测试

### 4.1 添加商品到购物车

**测试目标**: 验证添加商品到购物车功能

**测试步骤**:
1. 确保已登录
2. 访问商品详情页（如：http://127.0.0.1:5000/products/1）
3. 点击"加入购物车"按钮

**预期结果**:
- 显示成功提示: "商品已添加到购物车"
- 导航栏购物车图标旁的数字+1
- 或跳转到购物车页面

**验证数据库**:
```sql
SELECT * FROM cart_items WHERE user_id=1;
```

---

### 4.2 多次添加同一商品

**测试目标**: 验证购物车数量累加逻辑

**测试步骤**:
1. 访问同一商品详情页
2. 连续3次点击"加入购物车"按钮

**预期结果**:
- 购物车中该商品数量应为3（而不是3条记录）
- 数据库cart_items表中只有1条记录，quantity=3

**验证数据库**:
```sql
SELECT product_id, quantity FROM cart_items WHERE user_id=1 AND product_id=1;
```

---

### 4.3 添加多个不同商品

**测试目标**: 验证购物车多商品处理

**测试步骤**:
1. 添加商品1到购物车（2次）
2. 添加商品2到购物车（1次）
3. 添加商品3到购物车（3次）

**预期结果**:
- 购物车中有3条记录
- 商品1数量=2，商品2数量=1，商品3数量=3
- 购物车图标显示总数为6

---

### 4.4 查看购物车

**测试目标**: 验证购物车页面显示

**测试步骤**:
1. 点击导航栏的"购物车"链接
   - URL: http://127.0.0.1:5000/cart

**预期结果**:
- 显示购物车中的所有商品
- 每个商品显示：
  - 商品图片
  - 商品名称
  - 单价
  - 数量输入框（可修改）
  - 小计（单价×数量）
  - "删除"按钮
- 显示购物车总价
- 显示"继续购物"和"去结算"按钮

**验证要点**:
- ✅ 小计计算正确
- ✅ 总价计算正确
- ✅ 所有商品信息准确

---

### 4.5 修改购物车商品数量

**测试目标**: 验证修改购物车商品数量功能

**测试步骤 4.5.1: 增加数量**
1. 在购物车页面，找到某个商品
2. 将数量从1改为5
3. 点击"更新"按钮（如果有）

**预期结果**:
- 数量更新为5
- 小计重新计算
- 总价重新计算

**测试步骤 4.5.2: 减少数量**
1. 将数量从5改为1
2. 点击"更新"按钮

**预期结果**:
- 数量更新为1
- 小计和总价相应减少

**测试步骤 4.5.3: 数量设为0**
1. 将数量从1改为0
2. 点击"更新"按钮

**预期结果**:
- 该商品从购物车中移除
- 或提示"数量不能为0"

---

### 4.6 删除购物车商品

**测试目标**: 验证删除购物车商品功能

**测试步骤**:
1. 在购物车页面，找到某个商品
2. 点击"删除"按钮

**预期结果**:
- 显示确认提示或直接删除
- 该商品从购物车中消失
- 总价重新计算
- 数据库cart_items表中该记录被删除

**验证数据库**:
```sql
SELECT * FROM cart_items WHERE user_id=1 AND product_id=X;
# 应该返回空结果
```

---

### 4.7 清空购物车

**测试目标**: 验证清空购物车功能（如果实现）

**测试步骤**:
1. 在购物车页面
2. 点击"清空购物车"按钮（如果有）

**预期结果**:
- 显示确认对话框
- 确认后所有商品被清空
- 显示"购物车为空"提示

---

### 4.8 购物车计算验证

**测试目标**: 验证购物车价格计算的准确性

**测试步骤**:
1. 添加商品1（单价99.99）× 2
2. 添加商品2（单价299.00）× 1
3. 添加商品3（单价199.00）× 3

**预期结果**:
- 商品1小计: 99.99 × 2 = 199.98
- 商品2小计: 299.00 × 1 = 299.00
- 商品3小计: 199.00 × 3 = 597.00
- 总价: 199.98 + 299.00 + 597.00 = 1095.98

**验证**:
- 手动计算每个小计和总价
- 与页面显示对比

---

### 4.9 购物车权限控制

**测试目标**: 验证购物车的用户隔离

**测试步骤**:
1. 用户A登录，添加商品到购物车
2. 退出登录
3. 用户B登录，查看购物车

**预期结果**:
- 用户B的购物车为空（或只有用户B添加的商品）
- 不能看到用户A的购物车内容

---

## 第5部分：订单功能测试

### 5.1 订单结算流程

**测试目标**: 验证完整的下单流程

**测试步骤 5.1.1: 从购物车结算**
1. 登录普通用户账号（如testuser）
2. 添加商品到购物车（至少2个商品）
3. 访问购物车页面
4. 点击"去结算"按钮

**预期结果**:
- 跳转到结算页面
   - URL: http://127.0.0.1:5000/orders/checkout

---

### 5.2 填写订单信息

**测试目标**: 验证订单信息填写和验证

**测试步骤**:
1. 在结算页面填写表单
   ```
   收货人姓名: 张三
   联系电话: 13800138000
   收货地址: 北京市朝阳区某某街道123号
   邮政编码: 100000
   备注信息: 请周末配送
   ```

2. 检查订单明细
   - 确认商品列表正确
   - 确认数量正确
   - 确认总价正确

3. 点击"提交订单"按钮

**预期结果**:
- 显示成功提示: "订单创建成功"
- 跳转到订单详情页或订单列表
- 收到订单确认邮件（如果配置了邮件功能）

**验证数据库**:
```sql
-- 检查订单表
SELECT * FROM orders WHERE user_id=1 ORDER BY created_at DESC LIMIT 1;

-- 检查订单明细表
SELECT * FROM order_items WHERE order_id=?;
-- 将?替换为实际订单ID
```

---

### 5.3 订单详情查看

**测试目标**: 验证订单详情页显示

**测试步骤**:
1. 访问订单列表
   - URL: http://127.0.0.1:5000/orders
2. 点击某个订单

**预期结果**:
- 显示订单详细信息
  - 订单号（如：ORD20251225AB12CD34）
  - 下单时间
  - 订单状态（待支付/已支付/已发货/已完成/已取消）
  - 收货地址信息
  - 商品明细列表
    - 商品名称
    - 单价（快照价格）
    - 数量
    - 小计
  - 订单总价
  - 支付状态

---

### 5.4 订单列表展示

**测试目标**: 验证订单列表功能

**测试步骤**:
1. 创建多个订单（使用不同商品）
2. 访问订单列表
   - URL: http://127.0.0.1:5000/orders

**预期结果**:
- 显示当前用户的所有订单
- 按时间倒序排列（最新订单在前）
- 每个订单显示：
  - 订单号
  - 下单时间
  - 订单状态
  - 订单金额
  - 查看详情按钮

**验证要点**:
- ✅ 只显示当前用户的订单
- ✅ 订单状态颜色标识（待支付-橙色，已完成-绿色等）
- ✅ 分页功能（如果订单很多）

---

### 5.5 订单状态验证

**测试目标**: 验证订单初始状态

**验证步骤**:
1. 创建新订单
2. 查看订单详情

**预期结果**:
- 订单状态应为"待支付"（pending）

**验证数据库**:
```sql
SELECT order_number, status, total_amount FROM orders WHERE user_id=1 ORDER BY created_at DESC LIMIT 1;
```

---

### 5.6 库存扣减验证

**测试目标**: 验证下单后库存是否正确扣减

**测试步骤**:
1. 记录下单前商品库存
   ```sql
   SELECT name, stock FROM products WHERE id=1;
   ```
2. 下单购买3件商品1
3. 再次查询库存
   ```sql
   SELECT name, stock FROM products WHERE id=1;
   ```

**预期结果**:
- 库存应该减少3
- 如果原来库存=50，现在应该是47

**验证数据库**:
```sql
-- 对比前后库存变化
```

---

### 5.7 购物车清空验证

**测试目标**: 验证下单后购物车是否清空

**测试步骤**:
1. 添加商品到购物车
2. 完成下单
3. 返回购物车页面

**预期结果**:
- 购物车应该为空
- 显示"购物车为空"提示

**验证数据库**:
```sql
SELECT COUNT(*) FROM cart_items WHERE user_id=1;
-- 应该返回0
```

---

### 5.8 并发库存测试

**测试目标**: 验证库存不足时不能下单（高级测试）

**测试步骤**:
1. 找一个库存只有1件的商品
2. 在浏览器A中添加到购物车
3. 在浏览器B中（或另一个用户）也添加到购物车
4. 两个浏览器几乎同时下单

**预期结果**:
- 只有一个订单成功
- 另一个显示"库存不足"错误
- 库存不会被扣成负数

**注意事项**:
- 此测试需要打开两个浏览器或使用两个用户
- 考验数据库事务和并发控制

---

### 5.9 订单取消功能（如果实现）

**测试目标**: 验证订单取消功能

**测试步骤**:
1. 创建一个订单
2. 在订单详情页点击"取消订单"按钮
3. 确认取消

**预期结果**:
- 订单状态变为"已取消"
- 库存恢复（如果下单时扣减了库存）
- 显示成功提示

**验证数据库**:
```sql
SELECT status FROM orders WHERE id=?;
-- 应该显示"cancelled"
```

---

## 第6部分：管理员功能测试

### 6.1 管理员登录

**测试目标**: 验证管理员账号登录

**测试步骤**:
1. 访问登录页面
2. 使用管理员账号登录
   ```
   用户名: admin
   密码: admin123
   ```

**预期结果**:
- 成功登录
- 导航栏可能显示"管理后台"链接

---

### 6.2 管理员仪表盘

**测试目标**: 验证管理员仪表盘功能

**测试步骤**:
1. 登录管理员账号
2. 访问管理后台
   - URL: http://127.0.0.1:5000/admin
   - 或: http://127.0.0.1:5000/admin/dashboard

**预期结果**:
- 显示统计信息
  - 总订单数
  - 总商品数
  - 总用户数
  - 总销售额
- 显示管理功能导航
  - 商品管理
  - 订单管理
  - 用户管理
  - 统计报表

**验证要点**:
- ✅ 统计数据准确
- ✅ 导航链接有效

---

### 6.3 商品管理 - 添加商品

**测试目标**: 验证管理员添加商品功能

**测试步骤**:
1. 访问商品管理页面
   - URL: http://127.0.0.1:5000/admin/products
2. 点击"添加商品"按钮
3. 填写表单
   ```
   商品名称: 苹果iPhone 15
   商品描述: 最新款智能手机，性能强大
   价格: 5999.00
   库存: 100
   上架状态: 勾选
   商品图片: 上传一张图片
   ```
4. 点击"保存"按钮

**预期结果**:
- 显示成功提示
- 商品列表中显示新商品
- 数据库products表中新增记录

**验证数据库**:
```sql
SELECT * FROM products WHERE name='苹果iPhone 15';
```

---

### 6.4 商品管理 - 编辑商品

**测试目标**: 验证管理员编辑商品功能

**测试步骤**:
1. 在商品列表中找到某个商品
2. 点击"编辑"按钮
3. 修改商品信息
   ```
   价格: 从5999.00改为5599.00
   库存: 从100改为80
   描述: 添加一些新描述
   ```
4. 点击"更新"按钮

**预期结果**:
- 显示成功提示
- 商品信息已更新
- 商品列表中显示新的信息

**验证数据库**:
```sql
SELECT name, price, stock FROM products WHERE id=?;
-- 确认价格和库存已更新
```

---

### 6.5 商品管理 - 删除商品

**测试目标**: 验证管理员删除商品功能

**测试步骤**:
1. 先添加一个测试商品（用于删除）
2. 在商品列表中找到该商品
3. 点击"删除"按钮
4. 确认删除

**预期结果**:
- 显示成功提示
- 商品从列表中消失
- 数据库中该记录被删除

**验证数据库**:
```sql
SELECT * FROM products WHERE id=?;
-- 应该返回空结果
```

**注意事项**:
- 如果商品有订单记录，考虑是否允许删除
- 或使用软删除（标记为不可用）

---

### 6.6 商品管理 - 上架/下架

**测试目标**: 验证商品上架状态控制

**测试步骤 6.6.1: 下架商品**
1. 在商品管理页面，找到某个商品
2. 点击"下架"按钮
3. 或在编辑页面取消"上架"勾选

**预期结果**:
- 商品状态变为未上架
- 前台商品列表中不再显示该商品

**验证**:
1. 访问前台商品列表
2. 该商品应该不再显示

**测试步骤 6.6.2: 重新上架**
1. 点击"上架"按钮
2. 或在编辑页面勾选"上架"

**预期结果**:
- 商品状态变为上架
- 前台重新显示该商品

---

### 6.7 订单管理 - 查看订单

**测试目标**: 验证管理员查看所有订单功能

**测试步骤**:
1. 访问订单管理页面
   - URL: http://127.0.0.1:5000/admin/orders

**预期结果**:
- 显示所有用户的订单（不是仅当前管理员）
- 每个订单显示：
  - 订单号
  - 用户信息
  - 下单时间
  - 订单金额
  - 订单状态
  - 操作按钮（查看详情、更新状态等）

**验证要点**:
- ✅ 可以看到所有订单
- ✅ 订单信息完整
- ✅ 可以搜索或筛选（如果实现）

---

### 6.8 订单管理 - 更新订单状态

**测试目标**: 验证管理员更新订单状态功能

**测试步骤**:
1. 在订单管理页面，找到某个"待支付"订单
2. 点击订单详情
3. 点击"更新状态"按钮
4. 选择状态: "已支付"
5. 提交

**预期结果**:
- 订单状态更新为"已支付"
- 显示成功提示

**重复测试**:
- 将状态依次更新为：已发货 → 已完成

**验证数据库**:
```sql
SELECT order_number, status FROM orders WHERE id=?;
-- 确认状态已更新
```

---

### 6.9 订单管理 - 订单详情

**测试目标**: 验证管理员查看订单详情

**测试步骤**:
1. 在订单列表中点击某个订单
   - URL: http://127.0.0.1:5000/admin/orders/1

**预期结果**:
- 显示完整订单信息
  - 订单基本信息（订单号、时间、状态）
  - 用户信息（用户名、邮箱）
  - 收货地址
  - 商品明细列表
  - 价格汇总

---

### 6.10 用户管理 - 查看用户列表

**测试目标**: 验证管理员查看用户功能

**测试步骤**:
1. 访问用户管理页面
   - URL: http://127.0.0.1:5000/admin/users

**预期结果**:
- 显示所有注册用户
- 每个用户显示：
  - 用户名
  - 邮箱
  - 注册时间
  - 是否管理员
  - 账号状态（正常/禁用）
  - 操作按钮（编辑、删除等）

---

### 6.11 用户管理 - 编辑用户

**测试目标**: 验证管理员编辑用户功能

**测试步骤**:
1. 在用户列表中找到某个用户
2. 点击"编辑"按钮
3. 修改用户信息（如邮箱）
4. 修改账号状态（如禁用）
5. 提交

**预期结果**:
- 显示成功提示
- 用户信息已更新
- 如果禁用了用户，该用户无法登录

**验证**:
1. 使用被禁用账号尝试登录
2. 应该显示"账号已被禁用"错误

---

### 6.12 用户管理 - 删除用户

**测试目标**: 验证管理员删除用户功能

**测试步骤**:
1. 先创建一个测试用户
2. 在用户管理中找到该用户
3. 点击"删除"按钮
4. 确认删除

**预期结果**:
- 用户被删除
- 该用户无法登录

**注意事项**:
- 考虑用户有关联订单时的处理
- 可能需要软删除或禁止删除有订单的用户

---

### 6.13 统计报表（如果实现）

**测试目标**: 验证管理后台统计功能

**测试步骤**:
1. 访问统计页面
   - URL: http://127.0.0.1:5000/admin/statistics

**预期结果**:
- 显示各种统计图表
  - 销售趋势图
  - 热销商品排行
  - 用户注册趋势
  - 订单状态分布
- 可以按日期范围筛选

**验证要点**:
- ✅ 统计数据准确
- ✅ 图表显示正确
- ✅ 筛选功能有效

---

### 6.14 管理员权限控制

**测试目标**: 验证普通用户无法访问管理后台

**测试步骤**:
1. 退出管理员账号
2. 登录普通用户账号（testuser）
3. 直接访问: http://127.0.0.1:5000/admin

**预期结果**:
- 显示"需要管理员权限"错误提示
- 重定向到首页或上一页

**验证**:
- 尝试访问其他管理员页面
- 应该全部被拦截

---

## 第7部分：邮件功能测试

### 7.1 邮件配置检查

**测试目标**: 确认邮件服务已配置

**测试步骤**:
1. 检查.env文件
   ```
   MAIL_SERVER=smtp.gmail.com
   MAIL_PORT=587
   MAIL_USE_TLS=true
   MAIL_USERNAME=your-email@gmail.com
   MAIL_PASSWORD=your-app-password
   ```

2. 检查config.py中邮件配置

**注意事项**:
- 如果使用Gmail，需要开启两步验证并生成应用专用密码
- 确保邮件服务器地址和端口正确

---

### 7.2 订单确认邮件

**测试目标**: 验证下单后发送确认邮件

**测试步骤**:
1. 确保邮件服务已配置
2. 使用有有效邮箱的账号下单
3. 提交订单

**预期结果**:
- 页面显示订单创建成功
- 几秒后收到订单确认邮件（检查收件箱）

**验证邮件内容**:
- ✅ 邮件主题: "订单确认"
- ✅ 收件人: 下单用户邮箱
- ✅ 邮件内容包含:
  - 订单号
  - 订单明细
  - 收货地址
  - 订单总金额
  - 下单时间

---

### 7.3 邮件模板测试

**测试目标**: 验证邮件HTML模板

**验证步骤**:
1. 查看邮件HTML源码
2. 检查邮件模板文件
   - app/templates/email/order_confirmation.html

**预期结果**:
- 邮件格式美观
- 布局整齐
- 信息完整
- 响应式设计（移动端也能正常显示）

---

## 第8部分：异常场景测试

### 8.1 数据库连接失败

**测试目标**: 验证数据库连接失败时的错误处理

**测试步骤**:
1. 停止MySQL服务
   ```bash
   # Windows
   net stop mysql

   # macOS/Linux
   sudo systemctl stop mysql
   ```
2. 尝试访问网站

**预期结果**:
- 显示友好的错误页面
- 或显示"数据库连接失败"错误提示
- 不暴露敏感信息（如数据库密码）

**恢复**:
```bash
# 重启MySQL服务
# Windows
net start mysql

# macOS/Linux
sudo systemctl start mysql
```

---

### 8.2 表单CSRF攻击防护

**测试目标**: 验证CSRF令牌验证

**测试步骤**:
1. 打开浏览器开发者工具
2. 找到登录表单
3. 删除CSRF令牌字段
4. 提交表单

**预期结果**:
- 显示"CSRF token missing"错误
- 表单提交失败

**验证要点**:
- 所有表单都应该有CSRF保护
- POST请求必须有有效的CSRF令牌

---

### 8.3 SQL注入防护测试

**测试目标**: 验证系统对SQL注入的防护

**测试步骤 8.3.1: 登录表单**
1. 在登录表单的用户名字段输入:
   ```
   admin' OR '1'='1
   ```
2. 密码任意输入
3. 提交表单

**预期结果**:
- 登录失败
- 显示"用户名或密码错误"
- 不应该成功登录

**测试步骤 8.3.2: 搜索框（如果有）**
1. 在搜索框输入:
   ```
   '; DROP TABLE products; --
   ```
2. 点击搜索

**预期结果**:
- 搜索失败或无结果
- products表不应该被删除
- 使用ORM可以自动防止SQL注入

---

### 8.4 XSS攻击防护测试

**测试目标**: 验证系统对XSS攻击的防护

**测试步骤**:
1. 在商品评论或用户信息输入框输入:
   ```html
   <script>alert('XSS')</script>
   ```
2. 提交表单
3. 查看该信息显示的页面

**预期结果**:
- 不应该弹出alert对话框
- 脚本应该被转义显示为普通文本
- Jinja2模板自动转义可以防止XSS

---

### 8.5 文件上传安全测试

**测试目标**: 验证文件上传安全性（如果有商品图片上传）

**测试步骤 8.5.1: 上传非图片文件**
1. 尝试上传一个.exe或.php文件

**预期结果**:
- 显示"不支持的文件类型"错误
- 文件上传失败

**测试步骤 8.5.2: 上传超大文件**
1. 尝试上传一个超过16MB的文件

**预期结果**:
- 显示"文件过大"错误
- 文件上传失败

**测试步骤 8.5.3: 文件名注入**
1. 上传一个文件名为: `../../../malicious.jpg` 的图片

**预期结果**:
- 文件名应该被清理或重命名
- 不能路径遍历攻击

---

### 8.6 并发订单测试

**测试目标**: 验证库存超卖问题（高级测试）

**测试步骤**:
1. 找一个库存只有1件的商品
2. 打开两个浏览器窗口或使用两个用户
3. 两个窗口几乎同时下单购买该商品

**预期结果**:
- 只有一个订单成功
- 另一个显示"库存不足"
- 库存不会变成负数

**验证数据库**:
```sql
SELECT stock FROM products WHERE id=1;
-- 库存应该是0，不能是负数
```

**技术要点**:
- 数据库事务隔离级别
- 乐观锁或悲观锁
- SELECT ... FOR UPDATE

---

### 8.7 会话过期测试

**测试目标**: 验证会话过期处理

**测试步骤**:
1. 登录账号
2. 修改config.py中的会话时间（临时测试）
   ```python
   PERMANENT_SESSION_LIFETIME = timedelta(seconds=10)
   ```
3. 等待10秒
4. 点击需要登录的链接（如购物车）

**预期结果**:
- 重定向到登录页面
- 显示"会话已过期，请重新登录"提示

**恢复**:
- 将会话时间改回正常值

---

### 8.8 错误页面测试

**测试目标**: 验证自定义错误页面

**测试步骤 8.8.1: 404错误**
1. 访问不存在的页面
   - http://127.0.0.1:5000/this-page-does-not-exist

**预期结果**:
- 显示自定义404错误页面
- 页面友好，提供返回首页链接

**测试步骤 8.8.2: 500错误**
1. 故意制造一个服务器错误（如修改代码除以0）
2. 访问相关页面

**预期结果**:
- 显示自定义500错误页面
- 不暴露详细的错误堆栈信息

**注意**: 测试完成后恢复代码

---

## 第9部分：性能测试建议

### 9.1 页面加载速度

**测试方法**:
1. 打开浏览器开发者工具（F12）
2. 切换到"Network"标签
3. 访问各个页面
4. 查看加载时间

**建议指标**:
- 首页: < 1秒
- 商品列表: < 1秒
- 商品详情: < 500ms
- 购物车: < 500ms

---

### 9.2 数据库查询优化

**测试方法**:
1. 在config.py中开启SQL日志
   ```python
   SQLALCHEMY_ECHO = True
   ```
2. 访问各个页面
3. 观察控制台输出的SQL查询

**优化建议**:
- 避免N+1查询问题
- 使用join预加载关联数据
- 添加必要的数据库索引

---

### 9.3 压力测试（高级）

**测试工具**: Apache Bench (ab)

**测试步骤**:
```bash
# 安装ab（如果没有）
# Windows: 下载Apache
# macOS: brew install httpd
# Linux: sudo apt-get install apache2-utils

# 测试首页并发性能
ab -n 1000 -c 10 http://127.0.0.1:5000/

# 参数说明:
# -n 1000: 总共1000个请求
# -c 10: 10个并发
```

**预期结果**:
- 没有失败的请求
- 平均响应时间 < 500ms
- 95%请求响应时间 < 1秒

---

## 第10部分：移动端和响应式测试

### 10.1 响应式设计测试

**测试方法**:
1. 打开浏览器开发者工具（F12）
2. 点击设备工具栏图标（Ctrl+Shift+M）
3. 选择不同设备模拟
   - iPhone SE
   - iPhone 12 Pro
   - iPad
   - iPad Pro

**测试页面**:
- 首页
- 商品列表
- 商品详情
- 购物车
- 订单列表

**预期结果**:
- 所有页面在移动设备上正常显示
- 导航栏适配移动端（可能是汉堡菜单）
- 表格在小屏幕上可滚动或改为卡片布局
- 图片自适应屏幕宽度
- 文字大小适中，易于阅读

---

### 10.2 移动端操作测试

**测试步骤**:
1. 在移动设备模式下
2. 测试各种操作
   - 点击商品
   - 加入购物车
   - 修改数量
   - 填写表单
   - 提交订单

**预期结果**:
- 所有功能正常工作
- 按钮大小适合点击（至少44×44px）
- 输入框易于聚焦
- 表单验证提示清晰

---

## 第11部分：浏览器兼容性测试

### 11.1 测试浏览器

**建议测试的浏览器**:
- ✅ Chrome（推荐）
- ✅ Firefox
- ✅ Edge
- ✅ Safari（如果有Mac）
- ✅ 移动端Safari（iOS）
- ✅ 移动端Chrome（Android）

### 11.2 测试内容

在每个浏览器中测试:
1. 用户注册/登录
2. 浏览商品
3. 加入购物车
4. 下单
5. 管理员后台

**预期结果**:
- 所有功能在主流浏览器中正常工作
- 样式一致
- 没有JavaScript错误

---

## 第12部分：测试总结清单

### 12.1 功能测试清单

使用此清单跟踪测试进度：

- [ ] **用户认证**
  - [ ] 用户注册
  - [ ] 表单验证（用户名、邮箱、密码）
  - [ ] 用户登录
  - [ ] 错误密码处理
  - [ ] 记住我功能
  - [ ] 用户登出
  - [ ] 访问控制
  - [ ] 个人资料
  - [ ] 修改密码
  - [ ] 注销账号

- [ ] **商品功能**
  - [ ] 商品列表展示
  - [ ] 商品详情页
  - [ ] 分页功能
  - [ ] 商品搜索（如果有）
  - [ ] 库存显示

- [ ] **购物车功能**
  - [ ] 添加商品
  - [ ] 重复添加累加数量
  - [ ] 修改数量
  - [ ] 删除商品
  - [ ] 清空购物车
  - [ ] 价格计算
  - [ ] 用户隔离

- [ ] **订单功能**
  - [ ] 创建订单
  - [ ] 订单详情
  - [ ] 订单列表
  - [ ] 库存扣减
  - [ ] 购物车清空
  - [ ] 订单取消（如果有）
  - [ ] 并发库存控制

- [ ] **管理员功能**
  - [ ] 仪表盘
  - [ ] 添加商品
  - [ ] 编辑商品
  - [ ] 删除商品
  - [ ] 上架/下架
  - [ ] 查看订单
  - [ ] 更新订单状态
  - [ ] 用户管理
  - [ ] 统计报表
  - [ ] 权限控制

- [ ] **邮件功能**
  - [ ] 订单确认邮件
  - [ ] 邮件内容验证

- [ ] **异常处理**
  - [ ] 数据库连接失败
  - [ ] CSRF防护
  - [ ] SQL注入防护
  - [ ] XSS防护
  - [ ] 文件上传安全
  - [ ] 错误页面

- [ ] **其他**
  - [ ] 响应式设计
  - [ ] 浏览器兼容性
  - [ ] 性能测试

---

### 12.2 问题记录模板

测试过程中发现问题时，记录到文档：

| 问题编号 | 问题描述 | 严重程度 | 复现步骤 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|---------|---------|---------|------|
| BUG-001 | 购物车数量计算错误 | 高 | ... | ... | ... | 待修复 |
| BUG-002 | 移动端导航栏显示异常 | 中 | ... | ... | ... | 已修复 |

**严重程度**:
- 🔴 严重：核心功能无法使用
- 🟡 中等：功能可用但有瑕疵
- 🟢 轻微：UI小问题或建议

---

### 12.3 测试报告模板

完成测试后，填写测试报告：

```
测试日期: ___________
测试人员: ___________
应用版本: ___________

## 测试概况
- 总测试用例: ___ 个
- 通过: ___ 个
- 失败: ___ 个
- 通过率: ___%

## 发现的问题
1. ___________
2. ___________
3. ___________

## 总体评价
- 功能完整性: ⭐⭐⭐⭐⭐
- 用户体验: ⭐⭐⭐⭐⭐
- 性能表现: ⭐⭐⭐⭐⭐
- 安全性: ⭐⭐⭐⭐⭐

## 建议和改进
1. ___________
2. ___________
3. ___________
```

---

## 附录A：常用测试命令

### A.1 数据库操作

```bash
# 登录MySQL
mysql -u shop_user -p

# 查看所有数据库
SHOW DATABASES;

# 使用shop_db
USE shop_db;

# 查看所有表
SHOW TABLES;

# 查看用户表
SELECT * FROM users;

# 查看商品表
SELECT * FROM products;

# 查看订单表
SELECT * FROM orders ORDER BY created_at DESC;

# 查看购物车
SELECT * FROM cart_items;

# 清空购物车（测试用）
DELETE FROM cart_items WHERE user_id=1;

# 重置库存
UPDATE products SET stock=100;

# 退出MySQL
EXIT;
```

---

### A.2 Flask调试

```bash
# 启动应用（开发模式）
uv run python main.py

# 查看所有路由
uv run flask routes

# 进入Flask Shell
uv run flask shell

# 在Shell中操作
# >>> from app.models import User
# >>> users = User.query.all()
# >>> for user in users:
# ...     print(user.username)

# 清除所有数据（危险！）
# >>> from app.extensions import db
# >>> db.drop_all()
# >>> db.create_all()
```

---

### A.3 日志查看

```bash
# 查看Flask日志
# 在运行main.py的终端查看实时输出

# 启用详细SQL日志
# 修改config.py
SQLALCHEMY_ECHO = True

# 查看MySQL日志
# Windows: C:\ProgramData\MySQL\MySQL Server 8.0\Data\
# macOS/Linux: /var/log/mysql/
```

---

## 附录B：测试数据准备SQL

### B.1 批量插入测试商品

```sql
USE shop_db;

INSERT INTO products (name, description, price, stock, is_active, created_at, updated_at) VALUES
('iPhone 15 Pro', '苹果最新旗舰手机，A17芯片，钛金属边框', 7999.00, 50, NOW(), NOW()),
('MacBook Pro 14"', 'M3芯片，16GB内存，512GB存储', 14999.00, 20, NOW(), NOW()),
('AirPods Pro 2', '主动降噪，空间音频，USB-C充电盒', 1899.00, 100, NOW(), NOW()),
('iPad Air 5', 'M1芯片，10.9英寸 Liquid 视网膜显示屏', 4799.00, 30, NOW(), NOW()),
('Apple Watch Series 9', 'GPS款，45mm，午夜色铝金属', 3199.00, 60, NOW(), NOW()),
('Magic Keyboard', '无线键盘，中文布局，白色', 699.00, 200, NOW(), NOW()),
('Magic Mouse 2', '无线鼠标，多点触控表面', 599.00, 150, NOW(), NOW()),
('USB-C 转闪电转换线', '1米，原装配件', 145.00, 500, NOW(), NOW()),
('MagSafe 充电器', '15W快充，白色', 329.00, 300, NOW(), NOW()),
('AirTag', '物品追踪器，4个装', 799.00, 80, NOW(), NOW());
```

---

### B.2 创建测试用户

```sql
USE shop_db;

-- 普通用户1
INSERT INTO users (username, email, password_hash, is_admin, created_at, updated_at)
VALUES ('user1', 'user1@test.com', 'pbkdf2:sha256:260000$...', 0, NOW(), NOW());

-- 普通用户2
INSERT INTO users (username, email, password_hash, is_admin, created_at, updated_at)
VALUES ('user2', 'user2@test.com', 'pbkdf2:sha256:260000$...', 0, NOW(), NOW());

-- 注意: 密码hash需要通过代码生成
-- 或使用注册功能创建
```

---

## 附录C：常见测试问题解决

### C.1 问题：商品图片无法显示

**原因**:
- static/images/uploads/ 目录不存在
- 文件权限问题

**解决方案**:
```bash
# 创建上传目录
mkdir -p app/static/images/uploads

# Windows: 创建文件夹
# app\static\images\uploads\
```

---

### C.2 问题：邮件发送失败

**原因**:
- 邮件配置错误
- 网络问题
- Gmail需要应用专用密码

**解决方案**:
1. 检查.env配置
2. 确保Gmail开启了两步验证
3. 生成应用专用密码
4. 测试网络连接

---

### C.3 问题：库存没有扣减

**原因**:
- 下单代码没有调用扣减库存方法
- 数据库事务问题

**解决方案**:
1. 检查order.py中的下单逻辑
2. 确保调用了product.reduce_stock()
3. 确保db.session.commit()执行

---

### C.4 问题：购物车在订单创建后没有清空

**原因**:
- 清空购物车代码缺失

**解决方案**:
```python
# 在创建订单后添加
CartItem.query.filter_by(user_id=current_user.id).delete()
db.session.commit()
```

---

## 结语

本测试指南涵盖了Flask购物网站的所有核心功能和边界情况。按照此指南进行测试，可以：

1. ✅ 确保所有功能正常工作
2. ✅ 发现潜在的bug和问题
3. ✅ 验证安全性
4. ✅ 评估性能表现
5. ✅ 为实验报告提供测试数据

**测试建议**:
- 从头到尾完整测试一遍
- 记录所有发现的问题
- 截图保存关键测试步骤
- 测试完成后整理测试报告

**测试完成标准**:
- 所有核心功能测试通过
- 无严重bug
- 安全性验证通过
- 性能表现可接受

祝你测试顺利！🎉
